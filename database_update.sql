-- ===================================================================
-- 模型管理系统数据库更新脚本
-- 数据库: model_cloud
-- 用途: 更新标签分类和标签数据
-- 说明: 此脚本用于更新标签分类表结构并重新插入标签数据
-- ===================================================================

USE `model_cloud`;

-- ===================================================================
-- 1. 删除旧数据
-- ===================================================================

-- 1.1 删除模型标签表中的所有数据
DELETE FROM `bs_model_label`;

-- 1.2 删除标签分类表中的所有数据
DELETE FROM `model_label_category`;

-- ===================================================================
-- 2. 修改表结构
-- ===================================================================

-- 2.1 为 model_label_category 表添加 sort 列
-- 如果列已存在会报错，可以忽略或注释掉此语句
ALTER TABLE `model_label_category` 
ADD COLUMN `sort` INT DEFAULT 0 COMMENT '排序' AFTER `name`;

-- 2.2 为 bs_model_label 表添加 sort 列（重要：后端代码需要使用此列进行排序）
-- 如果列已存在会报错，可以忽略或注释掉此语句
ALTER TABLE `bs_model_label` 
ADD COLUMN `sort` INT DEFAULT 0 COMMENT '排序' AFTER `description`;

-- ===================================================================
-- 3. 插入新的标签分类数据（id从1开始）
-- ===================================================================

INSERT INTO `model_label_category` (`id`, `name`, `sort`) VALUES
(1, '处理器', 1),
(2, '文件格式', 2),
(3, '仿真领域', 3),
(4, '主要功能', 4),
(5, '操作系统', 5),
(6, '软件依赖', 6),
(7, '编程语言', 7);

-- ===================================================================
-- 4. 插入新的模型标签数据
-- ===================================================================

INSERT INTO `bs_model_label` (`name`, `category_id`, `is_del`) VALUES
-- 处理器 (category_id = 1)
('CPU', 1, 0),
('GPU', 1, 0),

-- 文件格式 (category_id = 2)
('FMU', 2, 0),
('M', 2, 0),
('INP', 2, 0),

-- 仿真领域 (category_id = 3)
('动力性能', 3, 0),
('结构安全', 3, 0),
('热管理', 3, 0),
('电控系统', 3, 0),

-- 主要功能 (category_id = 4)
('建模', 4, 0),
('分析仿真', 4, 0),
('后处理', 4, 0),

-- 操作系统 (category_id = 5)
('Windows', 5, 0),
('CentOS', 5, 0),
('Ubuntu', 5, 0),

-- 软件依赖 (category_id = 6)
('OpenModelica', 6, 0),
('Matlab/Simulink', 6, 0),
('Ansys', 6, 0),
('AutoCAD', 6, 0),
('Fluent', 6, 0),

-- 编程语言 (category_id = 7)
('C', 7, 0),
('Modelica', 7, 0),
('Matlab', 7, 0),
('Python', 7, 0);

-- ===================================================================
-- 5. 更新完成提示
-- ===================================================================

SELECT '数据库更新完成！' AS message;
SELECT '已更新以下内容：' AS info;
SELECT '  - 删除了所有旧的标签分类和标签数据' AS updates;
SELECT '  - 为 model_label_category 表添加了 sort 列' AS updates;
SELECT '  - 为 bs_model_label 表添加了 sort 列' AS updates;
SELECT '  - 插入了 7 个新的标签分类' AS updates;
SELECT '  - 插入了 23 个新的模型标签' AS updates;

